<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css"
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
        integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/js/bootstrap.min.js"
        integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
        crossorigin="anonymous"></script>

    <title>To Do List</title>

    <style>
        table {

            width: 50%;
            font-size: small;
            margin-top: 10px;
        }

        th,
        td {
            text-align: left;

        }

        /*tr:nth-child(even) {
    background-color: lightyellow;
}*/

        th {
            background-color: #04AA6D;
        }

        tr:hover {
            background-color: lightgray;
            color: darkblue;
        }

        th {
            background-color: #04AA6D;
            color: white;
        }
    </style>
</head>

<body>

    <div class="container">

        <div class="row text-center">

            <div class="col-md">

                <div class="m-2" id="maindiv">
                    <input type="text" id="task" placeholder="Enter your task">
                    <select id="task_statuses"">
                    <option>Select Status</option>
                    <option>Completed</option>
                    <option>In Complete</option>
                    </select>
                    <input type="submit" id="add" onclick="manage_tasks()" value="Add">
                        <label id="lblresults">...</label>
                       
                </div>

            </div>


        </div>

        <script>

            let tasks = JSON.parse(localStorage.getItem("tasks"));
            const tasksTable = document.createElement("table");
            tasksTable.id = "tasksTable";
            tasksTable.border = "0";

            const thead = document.createElement("thead");
            const tbody = document.createElement("tbody");
            const tr = document.createElement("tr");

            const th_Task = document.createElement("th");
            th_Task.innerHTML = "Task Name ";
            tr.appendChild(th_Task);
            const th_TastStatus = document.createElement("th");
            th_TastStatus.innerHTML = "Task Status";
            tr.appendChild(th_TastStatus);

            const th_Action = document.createElement("th");
            th_Action.innerHTML = " Action ";
            tr.appendChild(th_Action);

            thead.appendChild(tr);
            tasksTable.appendChild(thead);


            /// Create table to display already saved tasks 
            const loadTable = () => {

                document.getElementById('lblresults').innerHTML = "";



                //// table head is defined fetching data from tasks array now    

                const totalTasks = tasks.length - 1;

                for (let i = 0; i <= totalTasks; i++) {

                    const taskrow = document.createElement("tr");

                    for (x in tasks[i]) {
                        const taskvale = document.createElement("td");
                        taskvale.innerHTML = tasks[i][x];
                        taskvale.id = tasks[i][x];
                        taskrow.appendChild(taskvale);
                    }
                    const taskAction = document.createElement("td");
                    const taskActionbtn = document.createElement("button");
                    taskActionbtn.innerHTML = "Delete";
                    taskActionbtn.className = "btn btn-warning";
                    taskAction.appendChild(taskActionbtn);

                    taskrow.appendChild(taskAction);

                    tbody.appendChild(taskrow);
                }
                tasksTable.appendChild(tbody);



                document.body.appendChild(tasksTable);


            }

            loadTable();
            const manage_tasks = () => {

                let taskName, taskStatus;
                taskName = document.getElementById('task').value;
                taskStatus = document.getElementById('task_statuses').value;
                if (taskName == "") {
                    document.getElementById('task').focus();
                    document.getElementById('lblresults').innerHTML = " Enter Task Name ";
                    document.getElementById('lblresults').style.color = "red";
                }
                else if (tasks.some(n => n.taskName == taskName)) {
                    document.getElementById('lblresults').innerHTML = "Record Already Exists";
                    document.getElementById('lblresults').style.color = "red";
                }
                else if (taskStatus != "Select Status") {

                    const taskList = {
                        taskName,
                        taskStatus
                    }
                    console.log(taskList);
                    tasks.push(taskList);
                    localStorage.setItem('tasks', JSON.stringify(tasks));
                    tasks = JSON.parse(localStorage.getItem("tasks"));

                    const new_task = document.createElement('tr');
                    const newTaskName = document.createElement('td');
                    newTaskName.innerHTML = taskName;
                    new_task.appendChild(newTaskName);
                    const newTaskStatus = document.createElement('td');
                    newTaskStatus.innerHTML = taskStatus;
                    new_task.appendChild(newTaskStatus);
                    const taskAction = document.createElement("td");
                    const taskActionbtn = document.createElement("button");
                    taskActionbtn.innerHTML = "Delete";
                    taskAction.appendChild(taskActionbtn);
                    new_task.appendChild(taskAction);

                    tbody.appendChild(new_task);
                    tasksTable.appendChild(tbody);




                }

            }
            const deleteTask = (tvalue) => {
                tasks = tasks.map(n => n.taskName != tvalue ? n : null).filter(n => n != null);
                localStorage.setItem("tasks", JSON.stringify(tasks));
            }
            var table = document.getElementById("tasksTable");
            for (let i = 1; i <= table.rows.length; i++) {

                table.rows[i].cells[2].onclick = function () {
                    var c = confirm("Do You Want to Delete this Task?");
                    if (c) {
                        index = this.parentElement.rowIndex;
                        console.log(index);
                        deleteTask(table.rows[index].cells[0].innerHTML);
                        table.deleteRow(index);
                    }
                }


            }




        </script>
</body>

</html>